@page
@model CRM.Web.Pages.AuditLogs.IndexModel
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<SharedResource> Localizer

@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = Localizer["AuditLogs_Page_Title"];
}

@section Styles {
    <link rel="stylesheet" href="~/css/auditlogs/list.css" asp-append-version="true" />
}

<section class="page-header auditlogs-header">
    <div>
        <h1>@Localizer["AuditLogs_Page_Title"]</h1>
        <p class="subtitle">@Localizer["AuditLogs_Page_Subtitle"]</p>
    </div>
</section>

<form method="get" class="filter-form">
    <div class="filter-grid">
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_EntityType"]</label>
            <select name="entityType" asp-for="EntityType" class="filter-input">
                <option value="">@Localizer["Common_All"]</option>
                @foreach (var entityType in Model.EntityTypes)
                {
                    <option value="@entityType">@entityType</option>
                }
            </select>
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_Action"]</label>
            <select name="action" asp-for="Action" class="filter-input">
                <option value="">@Localizer["Common_All"]</option>
                <option value="Created">@Localizer["AuditLogs_Action_Created"]</option>
                <option value="Updated">@Localizer["AuditLogs_Action_Updated"]</option>
                <option value="Deleted">@Localizer["AuditLogs_Action_Deleted"]</option>
                <option value="Login">@Localizer["AuditLogs_Action_Login"]</option>
                <option value="Logout">@Localizer["AuditLogs_Action_Logout"]</option>
                <option value="FailedLogin">@Localizer["AuditLogs_Action_FailedLogin"]</option>
            </select>
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_User"]</label>
            <input type="text" name="userId" asp-for="UserId" placeholder="@Localizer["AuditLogs_Filter_User_Placeholder"]" class="filter-input" />
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_FromDate"]</label>
            <input type="date" name="fromDate" asp-for="FromDate" class="filter-input" />
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_ToDate"]</label>
            <input type="date" name="toDate" asp-for="ToDate" class="filter-input" />
        </div>
        <div class="filter-actions">
            <button type="submit" class="btn btn-primary">@Localizer["Common_Search"]</button>
            <a asp-page="Index" class="btn btn-ghost">@Localizer["Common_Clear"]</a>
        </div>
    </div>
</form>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>@Localizer["AuditLogs_Table_Timestamp"]</th>
                <th>@Localizer["AuditLogs_Table_EntityType"]</th>
                <th>@Localizer["AuditLogs_Table_EntityId"]</th>
                <th>@Localizer["AuditLogs_Table_Action"]</th>
                <th>@Localizer["AuditLogs_Table_User"]</th>
                <th>@Localizer["AuditLogs_Table_IpAddress"]</th>
                <th>@Localizer["AuditLogs_Table_Actions"]</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.AuditLogs.Items.Any())
            {
                foreach (var log in Model.AuditLogs.Items)
                {
                    <tr>
                        <td>@log.Timestamp.ToString("yyyy-MM-dd HH:mm:ss")</td>
                        <td><strong>@log.EntityType</strong></td>
                        <td><code>@log.EntityId.ToString("N")[..8]...</code></td>
                        <td>
                            @{
                                var actionKey = $"AuditLogs_Action_{log.Action}";
                                var actionDisplay = Localizer[actionKey].Value == actionKey ? log.Action : Localizer[actionKey].Value;
                            }
                            <span class="action-badge action-@log.Action.ToLower()">@actionDisplay</span>
                        </td>
                        <td>@(log.UserName ?? log.UserId ?? "-")</td>
                        <td>@(log.IpAddress ?? "-")</td>
                        <td>
                            <div class="action-buttons">
                                <a asp-page="Details" asp-route-id="@log.Id" class="btn-icon" title="@Localizer["Common_View"]">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                </a>
                            </div>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="empty-state">@Localizer["AuditLogs_Table_NoRecords"]</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (Model.TotalPages > 1)
{
    <div class="pagination">
        @if (Model.CurrentPage > 1)
        {
            <a asp-page="Index" 
               asp-route-page="@(Model.CurrentPage - 1)" 
               asp-route-entityType="@Model.EntityType"
               asp-route-action="@Model.Action"
               asp-route-userId="@Model.UserId"
               asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
               asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")"
               asp-route-pageSize="@Model.PageSize" 
               class="btn btn-ghost">@Localizer["Common_Previous"]</a>
        }
        <span>@Localizer["Common_PageInfo", Model.CurrentPage, Model.TotalPages] (@Localizer["Common_TotalRecords", Model.TotalCount])</span>
        @if (Model.CurrentPage < Model.TotalPages)
        {
            <a asp-page="Index" 
               asp-route-page="@(Model.CurrentPage + 1)" 
               asp-route-entityType="@Model.EntityType"
               asp-route-action="@Model.Action"
               asp-route-userId="@Model.UserId"
               asp-route-fromDate="@Model.FromDate?.ToString("yyyy-MM-dd")"
               asp-route-toDate="@Model.ToDate?.ToString("yyyy-MM-dd")"
               asp-route-pageSize="@Model.PageSize" 
               class="btn btn-ghost">@Localizer["Common_Next"]</a>
        }
    </div>
}

