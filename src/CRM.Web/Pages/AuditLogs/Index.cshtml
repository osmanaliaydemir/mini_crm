@page
@model CRM.Web.Pages.AuditLogs.IndexModel
@using Microsoft.Extensions.Localization
@using System.Text.Json
@inject IStringLocalizer<SharedResource> Localizer

@{
    Layout = "_DashboardLayout";
    ViewData["Title"] = Localizer["AuditLogs_Page_Title"];
}

@section Styles {
    <link rel="stylesheet" href="~/css/common/datatable.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/auditlogs/list.css" asp-append-version="true" />
}

<section class="page-header auditlogs-header">
    <div>
        <h1>@Localizer["AuditLogs_Page_Title"]</h1>
        <p class="subtitle">@Localizer["AuditLogs_Page_Subtitle"]</p>
    </div>
</section>

<form method="get" class="filter-form">
    <div class="filter-grid">
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_EntityType"]</label>
            <select name="entityType" asp-for="EntityType" class="filter-input">
                <option value="">@Localizer["Common_All"]</option>
                @foreach (var entityType in Model.EntityTypes)
                {
                    <option value="@entityType">@entityType</option>
                }
            </select>
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_Action"]</label>
            <select name="action" asp-for="Action" class="filter-input">
                <option value="">@Localizer["Common_All"]</option>
                <option value="Created">@Localizer["AuditLogs_Action_Created"]</option>
                <option value="Updated">@Localizer["AuditLogs_Action_Updated"]</option>
                <option value="Deleted">@Localizer["AuditLogs_Action_Deleted"]</option>
                <option value="Login">@Localizer["AuditLogs_Action_Login"]</option>
                <option value="Logout">@Localizer["AuditLogs_Action_Logout"]</option>
                <option value="FailedLogin">@Localizer["AuditLogs_Action_FailedLogin"]</option>
            </select>
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_User"]</label>
            <input type="text" name="userId" asp-for="UserId" placeholder="@Localizer["AuditLogs_Filter_User_Placeholder"]" class="filter-input" />
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_FromDate"]</label>
            <input type="date" name="fromDate" asp-for="FromDate" class="filter-input" />
        </div>
        <div class="filter-field">
            <label>@Localizer["AuditLogs_Filter_ToDate"]</label>
            <input type="date" name="toDate" asp-for="ToDate" class="filter-input" />
        </div>
        <div class="filter-actions">
            <button type="submit" class="btn btn-primary">@Localizer["Common_Search"]</button>
            <a asp-page="Index" class="btn btn-ghost">@Localizer["Common_Clear"]</a>
        </div>
    </div>
</form>

<section class="auditlogs-table-section">
    <article class="card table-card wide">
        <header class="card-header">
            <div>
                <h2>@Localizer["AuditLogs_Page_Title"]</h2>
                <p>@Localizer["AuditLogs_Page_Subtitle"]</p>
            </div>
            <div class="table-actions">
                <label class="search-control">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                        <circle cx="11" cy="11" r="7" />
                        <path d="m20 20-3.5-3.5" />
                    </svg>
                    <input type="search" data-auditlogs-search placeholder="@Localizer["Common_Search"].Value" />
                </label>
                <button type="button" class="btn btn-ghost" data-auditlogs-search-clear>@Localizer["Common_Clear"]</button>
            </div>
        </header>
        <div class="table-wrapper">
            <table id="auditLogsTable"
                   class="data-table"
                   data-order-column="0"
                   data-order-direction="desc">
                <thead>
                    <tr>
                        <th>@Localizer["AuditLogs_Table_Timestamp"]</th>
                        <th>@Localizer["AuditLogs_Table_EntityType"]</th>
                        <th>@Localizer["AuditLogs_Table_EntityId"]</th>
                        <th>@Localizer["AuditLogs_Table_Action"]</th>
                        <th>@Localizer["AuditLogs_Table_User"]</th>
                        <th>@Localizer["AuditLogs_Table_IpAddress"]</th>
                        <th class="text-end">@Localizer["AuditLogs_Table_Actions"]</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="table-empty-message" style="display: none; padding: 2rem; text-align: center; color: #64748b;">
                @Localizer["AuditLogs_Table_NoRecords"]
            </div>
        </div>
    </article>
</section>

@section Scripts {
    <script>
        window.auditLogsTableData = @Html.Raw(Model.AuditLogsTableJson ?? "[]");
        window.auditLogsTableConfig = {
            viewLabel: @Html.Raw(JsonSerializer.Serialize(Localizer["Common_View"].Value))
        };
    </script>
    <script src="~/js/auditlogs/list.js" asp-append-version="true"></script>
}

