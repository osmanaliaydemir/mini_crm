@page "{id:guid}"
@model CRM.Web.Pages.Customers.DetailsModel
@using Microsoft.Extensions.Localization
@using System.Linq
@inject IStringLocalizer<SharedResource> Localizer

@{
    Layout = "_DashboardLayout";
    if (Model.Customer is null)
    {
        ViewData["Title"] = Localizer["Customers_Details_NotFound_Title"];
    }
    else
    {
        ViewData["Title"] = $"{Localizer["Customers_Details_Title"]} Â· {Model.Customer.Name}";
    }
}

@section Styles {
    <link rel="stylesheet" href="~/css/customers/details.css" asp-append-version="true" />
}

@if (Model.Customer is null)
{
    <section class="details-empty">
        <article class="details-card">
            <h1>@Localizer["Customers_Details_NotFound_Title"]</h1>
            <p>@Localizer["Customers_Details_NotFound_Message"]</p>
            <div class="details-actions">
                <a class="btn btn-primary" asp-page="Index">@Localizer["Customers_Action_Back"]</a>
            </div>
        </article>
    </section>
}
else
{
    var customer = Model.Customer;

    <section class="page-header details-header">
        <div>
            <h1>@customer.Name</h1>
            @if (!string.IsNullOrWhiteSpace(customer.Segment))
            {
                <p class="subtitle">@customer.Segment</p>
            }
        </div>
        <div class="header-actions">
            <a class="btn btn-ghost" asp-page="Index">@Localizer["Customers_Action_Back"]</a>
            <a class="btn btn-primary" asp-page="Edit" asp-route-id="@customer.Id">@Localizer["Customers_Action_Edit"]</a>
        </div>
    </section>

    <section class="details-grid">
        <article class="details-card">
            <header>
                <h2>@Localizer["Customers_Details_Overview_Title"]</h2>
            </header>
            <dl class="details-definition">
                <div>
                    <dt>@Localizer["Customers_Field_Name"]</dt>
                    <dd>@customer.Name</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_LegalName"]</dt>
                    <dd>@(string.IsNullOrWhiteSpace(customer.LegalName) ? "-" : customer.LegalName)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_TaxNumber"]</dt>
                    <dd>@(string.IsNullOrWhiteSpace(customer.TaxNumber) ? "-" : customer.TaxNumber)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_Address"]</dt>
                    <dd>@(string.IsNullOrWhiteSpace(customer.Address) ? "-" : customer.Address)</dd>
                </div>
            </dl>
        </article>

        <article class="details-card">
            <header>
                <h2>@Localizer["Customers_Details_Contact_Title"]</h2>
            </header>
            @{ var primaryContact = Model.Contacts.FirstOrDefault(); }
            <dl class="details-definition">
                <div>
                    <dt>@Localizer["Customers_Field_Email"]</dt>
                    <dd>@(string.IsNullOrWhiteSpace(customer.Email) ? "-" : customer.Email)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_Phone"]</dt>
                    <dd>@(string.IsNullOrWhiteSpace(customer.Phone) ? "-" : customer.Phone)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_PrimaryContactName"]</dt>
                    <dd>@(primaryContact is null || string.IsNullOrWhiteSpace(primaryContact.FullName) ? "-" : primaryContact.FullName)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_PrimaryContactEmail"]</dt>
                    <dd>@(primaryContact is null || string.IsNullOrWhiteSpace(primaryContact.Email) ? "-" : primaryContact.Email)</dd>
                </div>
                <div>
                    <dt>@Localizer["Customers_Field_PrimaryContactPhone"]</dt>
                    <dd>@(primaryContact is null || string.IsNullOrWhiteSpace(primaryContact.Phone) ? "-" : primaryContact.Phone)</dd>
                </div>
            </dl>
        </article>

        <article class="details-card details-card--wide">
            <header>
                <h2>@Localizer["Customers_Details_Notes_Title"]</h2>
            </header>
            @if (string.IsNullOrWhiteSpace(customer.Notes))
            {
                <p class="empty">@Localizer["Customers_Details_Notes_Empty"]</p>
            }
            else
            {
                <p>@customer.Notes</p>
            }
        </article>

        <article class="details-card table-card">
            <header>
                <h2>@Localizer["Customers_Contacts_Title"]</h2>
            </header>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>@Localizer["Customers_Field_Name"]</th>
                            <th>@Localizer["Customers_Field_PrimaryContactPhone"]</th>
                            <th>@Localizer["Customers_Field_PrimaryContactEmail"]</th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var contact in Model.Contacts)
                    {
                        <tr>
                            <td>@contact.FullName</td>
                            <td>@(string.IsNullOrWhiteSpace(contact.Phone) ? "-" : contact.Phone)</td>
                            <td>@(string.IsNullOrWhiteSpace(contact.Email) ? "-" : contact.Email)</td>
                        </tr>
                    }
                    @if (!Model.Contacts.Any())
                    {
                        <tr>
                            <td colspan="3" class="empty">@Localizer["Customers_Contacts_Empty"]</td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </article>

        <article class="details-card form-card">
            <header>
                <h2>@Localizer["Customers_Interactions_Create_Title"]</h2>
            </header>
            <form method="post" class="inline-form">
                <input type="hidden" asp-for="InteractionForm.CustomerId" />
                <div asp-validation-summary="ModelOnly" class="form-validation-summary"></div>
                <div class="form-grid">
                    <div class="input-field">
                        <label asp-for="InteractionForm.InteractionDate">@Localizer["Customers_Interactions_Field_Date"]</label>
                        <input asp-for="InteractionForm.InteractionDate" class="input-control" type="datetime-local" />
                        <span asp-validation-for="InteractionForm.InteractionDate" class="input-error"></span>
                    </div>
                    <div class="input-field">
                        <label asp-for="InteractionForm.InteractionType">@Localizer["Customers_Interactions_Field_Type"]</label>
                        <input asp-for="InteractionForm.InteractionType" class="input-control" />
                        <span asp-validation-for="InteractionForm.InteractionType" class="input-error"></span>
                    </div>
                    <div class="input-field">
                        <label asp-for="InteractionForm.Subject">@Localizer["Customers_Interactions_Field_Subject"]</label>
                        <input asp-for="InteractionForm.Subject" class="input-control" />
                        <span asp-validation-for="InteractionForm.Subject" class="input-error"></span>
                    </div>
                    <div class="input-field full">
                        <label asp-for="InteractionForm.Notes">@Localizer["Customers_Interactions_Field_Notes"]</label>
                        <textarea asp-for="InteractionForm.Notes" class="input-control textarea" rows="3"></textarea>
                        <span asp-validation-for="InteractionForm.Notes" class="input-error"></span>
                    </div>
                    <div class="input-field">
                        <label asp-for="InteractionForm.RecordedBy">@Localizer["Customers_Interactions_Field_RecordedBy"]</label>
                        <input asp-for="InteractionForm.RecordedBy" class="input-control" />
                        <span asp-validation-for="InteractionForm.RecordedBy" class="input-error"></span>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">@Localizer["Customers_Interactions_Form_Submit"]</button>
            </form>
        </article>

        <article class="details-card table-card details-card--wide">
            <header>
                <h2>@Localizer["Customers_Interactions_List_Title"]</h2>
            </header>
            <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>@Localizer["Customers_Interactions_Field_Date"]</th>
                            <th>@Localizer["Customers_Interactions_Field_Type"]</th>
                            <th>@Localizer["Customers_Interactions_Field_Subject"]</th>
                            <th>@Localizer["Customers_Interactions_Field_Notes"]</th>
                            <th>@Localizer["Customers_Interactions_Field_RecordedBy"]</th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var interaction in Model.Interactions)
                    {
                        <tr>
                            <td>@interaction.InteractionDate.ToLocalTime().ToString("g")</td>
                            <td>@interaction.InteractionType</td>
                            <td>@interaction.Subject</td>
                            <td>@interaction.Notes</td>
                            <td>@interaction.RecordedBy</td>
                        </tr>
                    }
                    @if (!Model.Interactions.Any())
                    {
                        <tr>
                            <td colspan="5" class="empty">@Localizer["Customers_Interactions_Empty"]</td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </article>
    </section>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

